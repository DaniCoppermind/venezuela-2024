---
import "@fontsource/inter"
import "@fontsource/inter/800.css"
import Footer from "@/components/Footer.tsx"
import Navbar from "@/components/Navbar.tsx"
import Hero from "@/components/Hero.tsx"
import Contacts from "@/components/ContactList.tsx"
import States from "@/components/States.tsx"
import Layout from "@/layouts/Layout.astro"
import { sortRegion } from "@/utils/sortRegion"
import {supabase} from "../lib/supabase";

const regions_arr = (await supabase.from("Contact").select("region"))["data"]
const regions = [... new Set(sortRegion(regions_arr).map((e) => e.region))]
const reg: string | null = Astro.url.searchParams.get("reg") ?? null
const contact_query = reg
	? await supabase.from("Contact").select(`*`).eq('region', reg)
	: await supabase.from("Contact").select(`*`)
const contacts = contact_query["data"]
---

<Layout title="Venezuela Help 2024">
	<Navbar />
	<Hero />
	<States regions={regions} reg={reg} />
	<Contacts client:load contacts={contacts} reg={reg} />
	<Footer />
</Layout>

